# План разработки surge-tui

## Фазы разработки

### Фаза 1: Базовая архитектура и каркас (1-2 недели)
- [x] Структура проекта и модули
- [ ] Система маршрутизации экранов
- [ ] Базовые абстракции для экранов
- [ ] Глобальное состояние приложения
- [ ] Система событий и команд
- [ ] Конфигурация и настройки

### Фаза 2: Минимальный MVP (2-3 недели)
- [ ] Экран "Проект" (дерево файлов, статус)
- [ ] Базовый файловый менеджер
- [ ] Простейший редактор (read-only)
- [ ] Интеграция с surge CLI
- [ ] Экран сборки и диагностики

### Фаза 3: Полнофункциональный редактор (2-3 недели)
- [ ] Редактирование файлов
- [ ] Подсветка синтаксиса (регекс)
- [ ] Поиск и замена
- [ ] Undo/redo
- [ ] Автосохранение

### Фаза 4: Fix-режим и продвинутые функции (2-3 недели)
- [ ] Парсинг автофиксов от surge
- [ ] Предпросмотр diff
- [ ] Применение исправлений
- [ ] Журнал изменений

### Фаза 5: UX и полировка (1-2 недели)
- [ ] Палитра команд
- [ ] Настройки и темы
- [ ] Справочная система
- [ ] Логи и отчеты
- [ ] Оптимизация производительности

## Архитектурные принципы

### Модульность
- Каждый экран - отдельный модуль
- Переиспользуемые компоненты UI
- Четкое разделение ответственности

### Расширяемость
- Интерфейсы для экранов
- Система плагинов для команд
- Конфигурируемые хоткеи

### Производительность
- Ленивая загрузка экранов
- Фоновые операции
- Эффективное обновление UI

### Надежность
- Обработка ошибок
- Автосохранение
- Валидация пользовательского ввода

## Структура файлов

```
surge-tui/
├── cmd/
│   └── surge-tui/          # Точка входа
├── internal/
│   ├── app/                # Главное приложение
│   ├── ui/                 # UI компоненты
│   │   ├── screens/        # Экраны
│   │   ├── components/     # Переиспользуемые компоненты
│   │   └── styles/         # Стили и темы
│   ├── core/               # Бизнес-логика
│   │   ├── surge/          # Интеграция с surge CLI
│   │   ├── project/        # Управление проектом
│   │   ├── editor/         # Логика редактора
│   │   └── diagnostics/    # Диагностика и фиксы
│   ├── fs/                 # Файловая система
│   ├── config/             # Конфигурация
│   └── utils/              # Утилиты
├── pkg/                    # Публичные пакеты
└── assets/                 # Ресурсы
```

## Технологический стек

- **TUI Framework**: Bubble Tea + Bubbles + Lipgloss
- **Конфигурация**: YAML (gopkg.in/yaml.v3)
- **Файловые операции**: fsnotify для отслеживания изменений
- **CLI интеграция**: os/exec для запуска surge
- **Diff/patch**: собственная реализация или github.com/sergi/go-diff

## Ключевые интерфейсы

### Screen Interface
```go
type Screen interface {
    Init() tea.Cmd
    Update(tea.Msg) (Screen, tea.Cmd)
    View() string
    OnEnter() tea.Cmd
    OnExit() tea.Cmd
    CanExit() bool
}
```

### Command System
```go
type Command interface {
    Execute(ctx context.Context, args []string) error
    Description() string
    Usage() string
}
```

### Event System
```go
type EventBus interface {
    Subscribe(eventType string, handler EventHandler)
    Publish(event Event)
}
```

## Приоритеты реализации

1. **Критический путь**: Проект → Файлы → Редактор → Сборка
2. **Базовая навигация**: Переключение экранов, хоткеи
3. **Интеграция с surge**: Запуск команд, парсинг вывода
4. **UX полировка**: Темы, настройки, справка

## Метрики готовности

- Можно открыть проект и увидеть файлы
- Можно отредактировать файл и сохранить
- Можно запустить сборку и увидеть ошибки
- Можно перейти от ошибки к коду
- Время отклика UI < 100ms для основных операций